FROM python:3.11-slim-bookworm
ENV VIRTUAL_ENV=/opt/venv
ENV PATH="$VIRTUAL_ENV/bin:$PATH"
#required by coverage
ENV PYTHONPATH="$VIRTUAL_ENV/lib/python3.11/site-packages"
RUN pip install virtualenv \
    && python -m virtualenv --python=/usr/local/bin/python $VIRTUAL_ENV \
    && pip install coverage
COPY requirements.txt requirements.txt
RUN pip install -r requirements.txt &&\
    find $VIRTUAL_ENV | grep -E "(__pycache__|\.pyc|\.pyo$)" | xargs rm -rf
